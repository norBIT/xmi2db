# xmi2db
Konvertiert UML Klassenmodelle aus XMI Dateien in Tabellen und Typen nach PostgreSQL.

Abstract
XMI files are XML representations of UML models. Sometimes there is a need to have theses UML model elements especially the classes its attributes, the assosiations and generalisations in a database table structure.
xmi2db read an XMI file and write the UML Things into a database structure, which is oriented on the UML Structure. There are tables fore uml_classes, uml_attributes, class_generalizations, datatypes, stereotypes etc.
In a second step the function db2classes produce a relational database schema which have separate tables for each class and attributes in accordance to the type defined in UML. The conversion from UML datatyps into types of the data base can be easy adapted. The definition of tables consider the generalization of UML classes and uses inheritance. Multiplicity are accounted by defining array types of attribute. The assosiations will be realised by autogenerated gml_id attributes of type uuid for each superclass table. The function db2ogr producee a relational database schema without complexe datatypes. These schema can be used to import GML-Files with ogr2ogr.
Our xmi2db converter focus on UML models of GML application schemas used eg. for [INSPIRE](http://inspire.ec.europa.eu/data-model/approved/r4618-ir/html/) data specifications or German application schemas of the [AAA project](http://www.adv-online.de/AAA-Modell/) or [XPlanung](http://www.iai.fzk.de/www-extern/index.php?id=679). Therefore type UNION will be converted to a geometry type and the PostGIS extension is neccesary in our database model.
We use it especially to create database models derived from the currently frequently changing XPlanung UML model to be able to store and manage XPlanung features in a PostgreSQL database.

Zusammenfassung

XMI Dateien sind XML-Repräsentationen von UML-Modellen. Manchmal braucht man die UML Modellelemente, besonders die Klassen, seine Attribute, die Assoziationen und Generalisierungen, in einer Datenbank-Tabellenstruktur.
xmi2db liest eine XMI Datei und schreibt die UML Dinge in die Datenbankstrktur, welche sich an UML Strukturen orientiert. Es gibt Tabellen für uml_classes, uml_attributes, class_generalizations, datatypes, stereotypes usw.
In einem zweiten Schritt kann mit der Funktion db2classes ein relationales Datenbankschema erzeugt werden, welches für jede einzelne Klasse eine separate Tabelle erzeugt, mit Attributen, die zur Klasse passen. Die Tabellendefinition berücksichtigt die Generalisierung von UML-Klassen und die Vererbung. Multiplizität wird durch Definition der Attribute als Arrays berücksichtigt. Die Assoziationen werden verbunden durch gml_id Attribute vom Typ uuid. Die Funktion db2ogr erzeugt ein relationales Databankmodell ohne komplexe Datentypen. Dieses Schema kann für den Import von GML-Dateien mit ogr2ogr verwendet werden.
Der xmi2db converter fokusiert sich auf GML-Anwendungsschemas wie die für INSPIRE, das AAA-Modell oder XPlanung-Schema. Der Type UNION wird in geometry umgesetzt und die PostGIS Erweiterung für die Datenbank ist erforderlich.

db2classes wird für einen Shape-to-XPlanGML-Konverter für XPlanung konforme Raumordnungspläne verwendet wird.

db2ogr wird für das PostNAS Projekt verwendet um alle Modellelemente der NAS-Schnittstelle mit ogr2ogr in Postgres einlesen zu können.

Installation

* Clone das Projekt in das eigene Verzeichnis.
```
git clone https://github.com/pkorduan/xmi2db.git
```
* Erzeuge und editiere die Datei database_config.php
```
cp conf/database_conf_sample.php conf/database_conf.php
```
* Passe Datenbankzugang an: PG_HOST, PG_USER, PG_PASSWORD, PG_DBNAME

* Erzeuge eine Datenbank, die $PG_USER gehört und installiere die Erweiterung PostGIS

* Lege die zu importierende XMI-Datei im Unterordner xmis ab.

* Öffne den Link um auf die Konvertierungsoberfläche zu kommen. http://yourserver.de/xmi2db/

xmi2db

Führe als erstes die Funktion xmi2db "Fülle DB mit XMI Inhalten" aus um die UML-Elemente nach Postgres einzulesen.
Die Funktion erzeugt das Datenbankschema zur Speicherung der UML-Elemente und liest alle Klassen, Attribute, Beziehungen, Generalisierungen und Assoziationen aus der XMI-Datei aus und trägt sie in Tabellen ein.
* Wähle die XMI Datei aus dem Ordner xmis aus,
* Wähle ein Schemaname, z.b. aaa_uml
* Wähle den Namen des Basis Paketes des UML models aus.
* Klick auf "Fülle DB mit XMI Inhalten"
Die Schemanamen können auch in conf/database_config.php vordefiniert werden.

db2classes

Diese Funktion erzeugt den SQL-Code eines Datenbankschemas, welches für jede UML-Klasse eine Tabelle hat, für jeden Datentyp einen Postgrestyp und für jede Aufzählung einen Enumerationstyp und je eine Schlüsseltabelle für eine Enumeration und eine Codeliste.
* Wähle den Namen des Schemas aus in das die XMI eingelesen wurde.
* Wähle den Namen des Ausgabeschemas aus.

db2ogr

Diese Funktion erzeugt den SQL-Code eines flachen Datenbankschemas, welches für jede UML-Klasse eine Tabelle hat. Die Attribute sind jedoch nicht mit komplexen Datentypen versehen, sondern die Attribute der Datentypen sind als Attribute der Tabelle übernommen. Um doppelte Namen zu vermeiden werden einige Attribute umbenannt. Eine Liste der Umbenennungen kann mit der URL http://yourserver.de/xmi2db/listings/umbenennungsliste.php erzeugt werden.
* Wähle den Namen des Schemas aus in das die XMI eingelesen wurde.
* Wähle den Namen des Ausgabeschemas aus.

Um einen tieferen Einblick zu erhalten was alles abgefragt wird um die Schmata zu erzeugen kann der Parameter loglevel=1 mit angegeben werden. z.b.

```
http://meinserver.de/xmi2db/converter/db2classes.php?umlSchema=aaa_uml&gmlSchema=aaa_gml&loglevel=1
```

Filter

Das Schema, welches mit db2ogr erzeugt wird, kann durch einen Filter beschränkt werden. Dazu dient eine Filterdatei im JSON Format, dessen Name in conf/database_conf.php im Parameter FILTER_FILE eingestellt werden kann. Die Beispieldatei conf/filter_sample.json enthält folgende Filter.
```
{
	"AA_Modellart": {
		"attribute": {
			"sonstigesModell": 0
		}
	},
	"AA_Objekt": {
		"beziehungen": {
			"istTeilVon": 0
		}
	},
	"AX_Netzknoten": 0,
	"AX_Bauwerksfunktion_Leitung": 0
}
```
Im Element AA_Modellart wird das Attribut sonstigesModell ausgeschlossen. Im Element AA_Objekt wird die Beziehung istTeilVon ausgeschlossen. Zusätzlich wird das Elemente AX_Netzknoten und die Aufzählungsklasse AX_Bauwerksfunktion_Leitung vollständig weggelassen. Es können mehrere Attribute und Beziehungen getrennt durch Komma angegeben werden. Die Zahl hinter dem : hat noch nichts zu sagen und sollte mit 0 angegeben werden.

Diese Anwendung wurde 2016 entwickelt von Peter Korduan und Christian Seip.
